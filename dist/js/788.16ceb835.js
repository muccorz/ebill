"use strict";(self["webpackChunkebill"]=self["webpackChunkebill"]||[]).push([[788],{8788:function(t,e,a){a.r(e),a.d(e,{default:function(){return c}});var i=function(){var t=this,e=t._self._c;return e("div",[e("div",{staticClass:"h4",staticStyle:{"font-weight":"700","text-align":"left"}},[t._v("電子取引管理")]),e("el-divider"),e("el-row",{attrs:{gutter:20}},[e("el-col",{attrs:{span:16}},[e("el-form",{staticClass:"demo-form-inline",attrs:{inline:!0,model:t.condition}},[e("el-form-item",{attrs:{label:"取引年月日"}},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.condition.transactionDateFrom,expression:"condition.transactionDateFrom"}],ref:"datepickerInput1",staticClass:"el-input__inner",staticStyle:{width:"120px"},attrs:{type:"text",placeholder:"開始日"},domProps:{value:t.condition.transactionDateFrom},on:{input:function(e){e.target.composing||t.$set(t.condition,"transactionDateFrom",e.target.value)}}})]),e("el-form-item",{attrs:{label:""}},[t._v("~")]),e("el-form-item",{attrs:{label:""}},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.condition.transactionDateTo,expression:"condition.transactionDateTo"}],ref:"datepickerInput2",staticClass:"el-input__inner",staticStyle:{width:"120px"},attrs:{type:"text",placeholder:"終了日"},domProps:{value:t.condition.transactionDateTo},on:{input:function(e){e.target.composing||t.$set(t.condition,"transactionDateTo",e.target.value)}}})]),e("el-form-item",{attrs:{label:"取引金額範囲"}},[e("el-input",{staticStyle:{width:"100px"},attrs:{placeholder:"￥"},on:{blur:t.checkAmountFrom},model:{value:t.condition.transactionAmountFrom,callback:function(e){t.$set(t.condition,"transactionAmountFrom",e)},expression:"condition.transactionAmountFrom"}})],1),e("el-form-item",{attrs:{label:""}},[t._v("~")]),e("el-form-item",{attrs:{label:""}},[e("el-input",{staticStyle:{width:"100px"},attrs:{placeholder:"￥"},on:{blur:t.checkAmountTo},model:{value:t.condition.transactionAmountTo,callback:function(e){t.$set(t.condition,"transactionAmountTo",e)},expression:"condition.transactionAmountTo"}})],1),e("br"),e("el-form-item",{attrs:{label:"取引先"}},[e("el-select",{attrs:{filterable:"",placeholder:"入力又は選択"},model:{value:t.condition.customerno,callback:function(e){t.$set(t.condition,"customerno",e)},expression:"condition.customerno"}},t._l(t.customers,(function(t){return e("el-option",{key:t.customerno,attrs:{label:t.customer,value:t.customerno}})})),1)],1),e("el-form-item",{attrs:{label:"帳票種類"}},[e("el-select",{attrs:{filterable:"",placeholder:"入力又は選択"},model:{value:t.condition.billTypeno,callback:function(e){t.$set(t.condition,"billTypeno",e)},expression:"condition.billTypeno"}},t._l(t.billTypes,(function(t){return e("el-option",{key:t.billTypeno,attrs:{label:t.billType,value:t.billTypeno}})})),1)],1),t._v("  "),e("el-form-item",{attrs:{label:"登録ユーザー"}},[e("el-select",{attrs:{filterable:"",placeholder:"入力又は選択"},model:{value:t.condition.updateuserid,callback:function(e){t.$set(t.condition,"updateuserid",e)},expression:"condition.updateuserid"}},t._l(t.updateUsers,(function(t){return e("el-option",{key:t.updateuserid,attrs:{label:t.updateUserName,value:t.updateuserid}})})),1)],1)],1)],1),e("el-col",{attrs:{span:8}},[e("el-button",{attrs:{type:"primary"},on:{click:t.search}},[t._v("検 索")]),e("el-button",{attrs:{type:"warning"},on:{click:t.clear}},[t._v("クリア")]),e("br"),t.reviewBt?e("el-button",{attrs:{type:"primary"},on:{click:t.onSubmit}},[t._v("承認待ち")]):t._e(),t.downloadBt?e("el-button",{attrs:{type:"primary",disabled:t.exportBt},on:{click:t.download}},[t._v("エクスポート")]):t._e()],1)],1),e("el-table",{staticStyle:{width:"100%"},attrs:{data:t.billTableData},on:{"selection-change":t.handleSelectionChange,"row-click":t.handleRowClick,"sort-change":t.sortChange}},[e("el-table-column",{attrs:{type:"selection"}}),e("el-table-column",{attrs:{prop:"billno",label:"帳票番号",sortable:"sortable"}}),e("el-table-column",{attrs:{prop:"transactionymd",label:"取引年月日",sortable:"sortable"}}),e("el-table-column",{attrs:{prop:"transactionAmount",label:"取引金額",sortable:"sortable"}}),e("el-table-column",{attrs:{prop:"customer",label:"取引先"}}),e("el-table-column",{attrs:{prop:"billType",label:"帳票種類"}})],1),e("el-drawer",{attrs:{title:"履歴",visible:t.drawerflag,size:"80%"},on:{"update:visible":function(e){t.drawerflag=e},closed:t.clearBill}},[e("div",{staticClass:"d-flex",staticStyle:{margin:"30px 100px"}},[e("div",{staticStyle:{width:"44%"}},[e("el-form",{ref:"form",attrs:{model:t.bill,"label-width":"120px",disabled:!0}},[e("el-form-item",{attrs:{label:"帳票No"}},[e("span",{staticStyle:{"font-size":"16px"}},[t._v(t._s(t.bill.billno))])]),e("el-form-item",{attrs:{label:"取引年月日"}},[t._v("       "),e("el-input",{staticStyle:{width:"85%"},model:{value:t.bill.transactionymd,callback:function(e){t.$set(t.bill,"transactionymd",e)},expression:"bill.transactionymd"}})],1),e("el-form-item",{attrs:{label:"取引金額"}},[t._v("       "),e("el-input",{staticStyle:{width:"85%"},model:{value:t.bill.transactionAmount,callback:function(e){t.$set(t.bill,"transactionAmount",e)},expression:"bill.transactionAmount"}})],1),e("el-form-item",{attrs:{label:"取引先"}},[t._v("       "),e("el-input",{staticStyle:{width:"85%"},model:{value:t.bill.customer,callback:function(e){t.$set(t.bill,"customer",e)},expression:"bill.customer"}})],1),e("el-form-item",{attrs:{label:"帳票種類"}},[t._v("       "),e("el-input",{staticStyle:{width:"85%"},model:{value:t.bill.billType,callback:function(e){t.$set(t.bill,"billType",e)},expression:"bill.billType"}})],1),e("el-form-item",{attrs:{label:"訂正備考"}},[t._v("       "),e("el-input",{staticStyle:{width:"85%"},attrs:{type:"textarea",rows:3},model:{value:t.bill.remark,callback:function(e){t.$set(t.bill,"remark",e)},expression:"bill.remark"}})],1),e("el-form-item",{attrs:{label:"登録日時"}},[t._v("       "),e("el-input",{staticStyle:{width:"85%"},model:{value:t.bill.updateymd,callback:function(e){t.$set(t.bill,"updateymd",e)},expression:"bill.updateymd"}})],1),e("el-form-item",{attrs:{label:"登録ユーザー"}},[t._v("       "),e("el-input",{staticStyle:{width:"85%"},model:{value:t.bill.updateUserName,callback:function(e){t.$set(t.bill,"updateUserName",e)},expression:"bill.updateUserName"}})],1)],1),e("el-button",{attrs:{size:"medium",type:"primary",disabled:t.editBt},on:{click:t.edit}},[t._v("訂正")]),e("el-button",{attrs:{size:"medium",type:"primary",disabled:t.agreeBt},on:{click:t.agree}},[t._v("承認")]),e("el-button",{attrs:{size:"medium",type:"info",disabled:t.disagreeBt},on:{click:t.disagree}},[t._v("拒否")]),t._v("         "),t.editPermissonsBt?e("el-button",{attrs:{size:"medium",type:"warning"},on:{click:t.giveEditPermissons}},[t._v("訂正権限を付く")]):t._e()],1),e("embed",{staticStyle:{position:"absolute",top:"5%",right:"2%"},attrs:{src:t.bill.imageUrl,type:"application/pdf",width:"50%",height:"70%"}})]),e("el-table",{staticStyle:{width:"80%","margin-top":"4%","margin-left":"3%"},attrs:{data:t.bill.Logs,border:!0}},[e("el-table-column",{attrs:{prop:"date",label:"取引年月日"}}),e("el-table-column",{attrs:{prop:"money",label:"取引金額"}}),e("el-table-column",{attrs:{prop:"custom",label:"取引先"}}),e("el-table-column",{attrs:{prop:"paper",label:"帳票種類"}}),e("el-table-column",{attrs:{prop:"log",label:"訂正備考"}}),e("el-table-column",{attrs:{prop:"date2",label:"登録日時"}}),e("el-table-column",{attrs:{prop:"user",label:"登録ユーザー"}})],1)],1),e("div",{staticClass:"block"},[e("el-pagination",{attrs:{"current-page":t.currentPage,"page-size":t.pagesize,"page-sizes":[10,50,100,500],layout:"total,sizes, prev, pager, next, jumper",total:t.totalBill},on:{"current-change":t.pageCurrentChange,"update:currentPage":function(e){t.currentPage=e},"update:current-page":function(e){t.currentPage=e},"size-change":t.handleSizeChange}})],1)],1)},l=[],o=(a(7658),a(6229),a(7330),a(2062),a(7516)),s=(a(51),{name:"billView",data(){return{drawerflag:!1,multipleSelection:[],conditionFlag:!1,sortFlag:!1,onSubmitFlag:!1,editBt:!0,agreeBt:!0,disagreeBt:!0,reviewBt:!1,downloadBt:!1,editPermissonsBt:!1,sort:!1,order:"",totalBill:"",currentPage:1,pagesize:10,customers:[],billTypes:[],updateUsers:[],timeout:null,date:"",bill:{billno:"",billType:"",customer:"",remark:"",transactionAmount:"",transactionymd:"",updateUserName:"",updateymd:"",reviewStatus:"",editPermissions:!1,imageUrl:"",Logs:[]},billTableData:[],condition:{transactionDateFrom:"",transactionDateTo:"",transactionAmountFrom:"",transactionAmountTo:"",customerno:"",billTypeno:"",updateuserid:""}}},computed:{exportBt(){return 0==this.multipleSelection.length}},methods:{handleSizeChange(t){this.pagesize=t,this.getBillsByFlag()},sortChange(t){this.sort=t.order,this.order=t.prop,this.sortFlag=!0,this.currentPage=1,1==this.conditionFlag?this.$http.post("/bill/conditionSearch",{currentPage:this.currentPage,pagesize:this.pagesize,condition:this.condition,sort:this.sort,order:this.order}).then((t=>{200==t.data.code&&(this.billTableData=t.data.data,this.totalBill=t.data.data[0].totalBill)})):1==this.onSubmitFlag?this.$http.post("//bill/getOnSubmit",{currentPage:this.currentPage,pagesize:this.pagesize,sort:this.sort,order:this.order}).then((t=>{200==t.data.code&&(this.billTableData=t.data.data,this.totalBill=t.data.data[0].totalBill)})):this.$http.post("/bill/getBills",{currentPage:this.currentPage,pagesize:this.pagesize,order:this.sort,prop:this.order}).then((t=>{200==t.data.code&&(this.billTableData=t.data.data)}))},checkAmountFrom(){/^-?\d+$/.test(this.condition.transactionAmountFrom)||""==this.condition.transactionAmountFrom||(this.$message({type:"error",message:"整数のみ入力"}),this.condition.transactionAmountFrom="")},checkAmountTo(){/^-?\d+$/.test(this.condition.transactionAmountTo)||""==this.condition.transactionAmountTo||(this.$message({type:"error",message:"整数のみ入力"}),this.condition.transactionAmountTo="")},giveEditPermissons(){this.$http.get("/bill/giveEditPermissons/"+this.bill.billno).then((t=>{200==t.data.code&&this.$message({type:"success",message:"編集権限を付く完了"})}))},edit(){this.$router.push({path:"/edit/"+this.bill.billno})},agree(){this.$http.get("/bill/agreeBill").then((t=>{200==t.data.code&&(this.$message({type:"success",message:"承認完了"}),this.drawerflag=!1)}))},disagree(){this.$http.get("/bill/disagreeBill").then((t=>{200==t.data.code&&(this.$message({type:"success",message:"拒否完了"}),this.drawerflag=!1)}))},pageCurrentChange(t){this.currentPage=t,this.getBillsByFlag()},getBillsByFlag(){0==this.sortFlag?1==this.conditionFlag?this.$http.post("/bill/conditionSearch",{currentPage:this.currentPage,pagesize:this.pagesize,condition:this.condition}).then((t=>{200==t.data.code&&(this.billTableData=t.data.data,this.totalBill=t.data.data[0].totalBill)})):1==this.onSubmitFlag?this.$http.post("//bill/getOnSubmit",{currentPage:this.currentPage,pagesize:this.pagesize}).then((t=>{200==t.data.code&&(this.billTableData=t.data.data,this.totalBill=t.data.data[0].totalBill)})):this.getBills():1==this.conditionFlag?this.$http.post("/bill/conditionSearch",{currentPage:this.currentPage,pagesize:this.pagesize,condition:this.condition,sort:this.sort,order:this.order}).then((t=>{200==t.data.code&&(this.billTableData=t.data.data,this.totalBill=t.data.data[0].totalBill)})):1==this.onSubmitFlag?this.$http.post("//bill/getOnSubmit",{currentPage:this.currentPage,pagesize:this.pagesize,sort:this.sort,order:this.order}).then((t=>{200==t.data.code&&(this.billTableData=t.data.data,this.totalBill=t.data.data[0].totalBill)})):this.$http.post("/bill/getBills",{currentPage:this.currentPage,pagesize:this.pagesize,sort:this.sort,order:this.order}).then((t=>{200==t.data.code&&(this.billTableData=t.data.data,this.totalBill=t.data.data[0].totalBill)}))},clearBill(){this.bill={billType:"",customer:"",remark:"",transactionAmount:"",transactionymd:"",updateUserName:"",updateymd:"",imageUrl:"",Logs:[]}},getBills(){this.$http.post("/bill/getBills",{currentPage:this.currentPage,pagesize:this.pagesize}).then((t=>{200==t.data.code&&(this.billTableData=t.data.data,this.totalBill=t.data.data[0].totalBill)}))},handleSelectionChange(t){this.multipleSelection=[],t.forEach((t=>{this.multipleSelection.push(t.billno)}))},search(){const t=new Date(this.condition.transactionDateFrom),e=new Date(this.condition.transactionDateTo);if(t>e)return void this.$message({type:"error",message:"開始日は終了日より小さい"});let a=Number(this.condition.transactionAmountFrom),i=Number(this.condition.transactionAmountTo);""!=this.condition.transactionAmountFrom&&""!=this.condition.transactionAmountTo&&a>i?this.$message({type:"error",message:"金額範囲は0より小さい"}):(this.conditionFlag=!0,this.onSubmitFlag=!1,this.currentPage=1,this.$http.post("/bill/conditionSearch",{currentPage:this.currentPage,pagesize:this.pagesize,condition:this.condition}).then((t=>{200==t.data.code&&(this.billTableData=t.data.data,this.totalBill=t.data.data[0].totalBill)})))},clear(){this.condition.transactionDateFrom="",this.condition.transactionDateTo="",this.condition.transactionAmountFrom="",this.condition.transactionAmountTo="",this.condition.customerno="",this.condition.billTypeno="",this.condition.updateuserid="",this.onSubmitFlag=!1,this.conditionFlag=!1,this.currentPage=1,this.sortFlag=!1,this.sort=null,this.order=null,this.getBills()},onSubmit(){this.onSubmitFlag=!0,this.conditionFlag=!1,this.currentPage=1,this.$http.post("/bill/getOnSubmit",{currentPage:this.currentPage,pagesize:this.pagesize}).then((t=>{200==t.data.code&&(this.billTableData=t.data.data,this.totalBill=t.data.data[0].totalBill)}))},download(){this.$http.post("/bill/downloadBill",this.multipleSelection,{responseType:"blob"}).then((t=>{const e=new Blob([t.data]),a=window.URL.createObjectURL(e),i=document.createElement("a");i.href=a,i.download="downloaded_file.txt",i.click(),window.URL.revokeObjectURL(a)}))},handleRowClick(t){this.$http.get("/bill/getBillDetails/"+t.billno).then((t=>{if(200==t.data.code)for(let e=0;e<t.data.data.length;e++)0==e?this.bill=t.data.data[e]:this.bill.Logs[e]=t.data.data[e]})),1==this.bill.reviewStatus&&(this.agreeBt=!0,this.disagreeBt=!0),this.bill.editPermissions?this.editPermissonsBt=!1:(4!=sessionStorage.getItem("rolesno")&&3!=sessionStorage.getItem("rolesno")||(this.editPermissonsBt=!0),this.editBt=!0),this.drawerflag=!0},handleAvatarSuccess(t){console.log(t),this.bill.imageUrl=t},loadCustomers(){this.$http.get("/category/getCustomers").then((t=>{200==t.data.code&&(this.customers=t.data.data)}))},loadBillTypes(){this.$http.get("/category/getBillTypes").then((t=>{200==t.data.code&&(this.billTypes=t.data.data)}))},loadUpdateUsers(){this.$http.get("/bill/getUpdateUserids").then((t=>{200==t.data.code&&(this.updateUsers=t.data.data)}))}},mounted(){this.loadCustomers(),this.loadBillTypes(),this.loadUpdateUsers(),this.getBills();var t=sessionStorage.getItem("rolesno");switch(t){case"1":this.reviewBt=!1,this.downloadBt=!1,this.editBt=!1;break;case"2":this.reviewBt=!1,this.downloadBt=!0;break;case"3":this.reviewBt=!0,this.downloadBt=!0,this.agreeBt=!1,this.disagreeBt=!1;break;case"4":this.editFlag=!0,this.reviewBt=!0,this.downloadBt=!0,this.editBt=!1,this.agreeBt=!1,this.disagreeBt=!1,this.editPermissonsBt=!0;break}(0,o.Z)(this.$refs.datepickerInput1,{dateFormat:"Y/m/d",locale:"ja",firstDayOfWeek:"0",allowInput:"true",minDate:"1990/01/01",maxDate:"today"}),(0,o.Z)(this.$refs.datepickerInput2,{dateFormat:"Y/m/d",locale:"ja",firstDayOfWeek:"0",allowInput:"true",minDate:"1990/01/01",maxDate:"today"})}}),n=s,r=a(1001),d=(0,r.Z)(n,i,l,!1,null,"3f62c3b2",null),c=d.exports}}]);
//# sourceMappingURL=788.16ceb835.js.map